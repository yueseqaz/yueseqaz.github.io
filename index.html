<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>🎥 WebRTC 屏幕共享</title>
  <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
  <style>
    body { font-family: sans-serif; text-align: center; margin: 2em; }
    input, button { padding: 0.5em; margin: 0.5em; font-size: 1em; }
    video { max-width: 90vw; max-height: 60vh; margin-top: 1em; border: 2px solid #aaa; border-radius: 8px; }
  </style>
</head>
<body>
  <h1>🖥 WebRTC 屏幕共享工具</h1>

  <div id="shareDiv">
    <button onclick="startShare()">📤 开始共享屏幕</button><br />
    你的 ID: <input type="text" id="myId" readonly>
  </div>

  <hr />

  <div id="watchDiv">
    <input type="text" id="remoteId" placeholder="输入对方 ID">
    <button onclick="startWatch()">📥 观看屏幕</button>
  </div>

  <video id="video" autoplay playsinline controls></video>

  <script>
    const peer = new Peer(); // 使用默认的 peerjs cloud server
    const myIdInput = document.getElementById("myId");
    const remoteIdInput = document.getElementById("remoteId");
    const video = document.getElementById("video");

    peer.on("open", id => {
      myIdInput.value = id;
    });

    function startShare() {
      navigator.mediaDevices.getDisplayMedia({ video: true, audio: false })
        .then(stream => {
          video.srcObject = stream;
          peer.on("call", call => {
            call.answer(stream); // 响应观看者请求，推送屏幕流
          });
        })
        .catch(err => alert("无法获取屏幕共享权限: " + err));
    }

    function startWatch() {
      const id = remoteIdInput.value.trim();
      if (!id) return alert("请输入分享者的 ID");
      const call = peer.call(id, null); // 发起请求
      call.on("stream", stream => {
        video.srcObject = stream; // 显示远程视频流
      });
    }
  </script>
</body>
</html>
