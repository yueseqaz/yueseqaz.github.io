<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>ğŸ¥ WebRTC å±å¹•å…±äº«</title>
  <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
  <style>
    body { font-family: sans-serif; text-align: center; margin: 2em; }
    input, button { padding: 0.5em; margin: 0.5em; font-size: 1em; }
    video { max-width: 90vw; max-height: 60vh; margin-top: 1em; border: 2px solid #aaa; border-radius: 8px; }
  </style>
</head>
<body>
  <h1>ğŸ–¥ WebRTC å±å¹•å…±äº«å·¥å…·</h1>

  <div id="shareDiv">
    <button onclick="startShare()">ğŸ“¤ å¼€å§‹å…±äº«å±å¹•</button><br />
    ä½ çš„ ID: <input type="text" id="myId" readonly>
  </div>

  <hr />

  <div id="watchDiv">
    <input type="text" id="remoteId" placeholder="è¾“å…¥å¯¹æ–¹ ID">
    <button onclick="startWatch()">ğŸ“¥ è§‚çœ‹å±å¹•</button>
  </div>

  <video id="video" autoplay playsinline controls></video>

  <script>
    const peer = new Peer(); // ä½¿ç”¨é»˜è®¤çš„ peerjs cloud server
    const myIdInput = document.getElementById("myId");
    const remoteIdInput = document.getElementById("remoteId");
    const video = document.getElementById("video");

    peer.on("open", id => {
      myIdInput.value = id;
    });

    function startShare() {
      navigator.mediaDevices.getDisplayMedia({ video: true, audio: false })
        .then(stream => {
          video.srcObject = stream;
          peer.on("call", call => {
            call.answer(stream); // å“åº”è§‚çœ‹è€…è¯·æ±‚ï¼Œæ¨é€å±å¹•æµ
          });
        })
        .catch(err => alert("æ— æ³•è·å–å±å¹•å…±äº«æƒé™: " + err));
    }

    function startWatch() {
      const id = remoteIdInput.value.trim();
      if (!id) return alert("è¯·è¾“å…¥åˆ†äº«è€…çš„ ID");
      const call = peer.call(id, null); // å‘èµ·è¯·æ±‚
      call.on("stream", stream => {
        video.srcObject = stream; // æ˜¾ç¤ºè¿œç¨‹è§†é¢‘æµ
      });
    }
  </script>
</body>
</html>
